<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>آب‌وهوای پیشرفته</title>
  <style>
    
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #74b9ff 0%, #0984e3 50%, #6c5ce7 100%);
  min-height: 100vh;
  color: #333;
  overflow-x: hidden;
  margin: 0;
  padding: 0;
}

.container {
  max-width: 1400px;
  margin: auto;
  padding: 20px;
}

.header h1 {
  text-align: center;
  color: white;
  font-size: 2.8rem;
  margin-bottom: 10px;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.search-box {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  justify-content: center;
  margin: 20px auto;
  background: rgba(255, 255, 255, 0.95);
  padding: 20px;
  border-radius: 20px;
  backdrop-filter: blur(10px);
}

input {
  padding: 15px;
  font-size: 1rem;
  border-radius: 30px;
  border: 2px solid #0984e3;
  width: 300px;
  text-align: center;
}

button {
  padding: 15px 30px;
  background: linear-gradient(45deg, #0984e3, #74b9ff);
  color: white;
  border: none;
  border-radius: 30px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

button:hover {
  background: linear-gradient(45deg, #74b9ff, #0984e3);
}

.weather-card, .hourly-item, .daily-item, .city-card {
  background: white;
  padding: 20px;
  border-radius: 20px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
  margin: 20px auto;
  max-width: 95%;
}

.weather-icon-main, .weather-icon-small {
  width: 80px;
  height: 80px;
  margin: 10px auto;
}

.hourly-item, .daily-item {
  min-width: 120px;
  display: inline-block;
  margin: 10px;
  text-align: center;
}

.weather-card h3 {
  margin-bottom: 10px;
  font-size: 1.4rem;
  color: #0984e3;
}

.world-cities {
  display: flex;
  flex-wrap: nowrap;
  overflow-x: auto;
  gap: 15px;
  padding-bottom: 10px;
}

.city-card {
  min-width: 200px;
  background: linear-gradient(45deg, #00b894, #00cec9);
  color: white;
  border-radius: 15px;
  padding: 20px;
  text-align: center;
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  flex-shrink: 0;
}

.city-card h4 {
  margin: 0;
  font-size: 1.1rem;
}

.spinner {
  width: 50px;
  height: 50px;
  border: 5px solid #f3f3f3;
  border-top: 5px solid #0984e3;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: auto;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ریسپانسیو برای موبایل */
@media (max-width: 768px) {
  .header h1 {
    font-size: 2rem;
  }

  input {
    width: 90%;
  }

  .weather-icon-main {
    width: 60px;
    height: 60px;
  }

  .city-card {
    min-width: 180px;
  }

  .hourly-item, .daily-item {
    min-width: 100px;
  }
}

  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>🌤️ آب‌وهوای پیشرفته</h1>
      <p>پیش‌بینی دقیق و ریسپانسیو برای هر دستگاه</p>
    </div>

    <div class="search-container">
      <div class="search-box">
        <input type="text" id="cityInput" placeholder="نام شهر یا کشور...">
        <button onclick="getWeather()">🔍 جستجو</button>
      </div>
    </div>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>در حال دریافت اطلاعات...</p>
    </div>

    <div id="mainWeather"></div>
    <div id="hourlyForecast"></div>
    <div id="dailyForecast"></div>

    <div class="world-weather">
      <h2 class="section-title">🌍 وضعیت شهرهای مهم جهان</h2>
      <div class="world-cities" id="worldCities"></div>
    </div>
  </div>

  <script>
    
const apiKey = "ee24450910228c08cc8613af1e387e85";

document.getElementById("cityInput").addEventListener("keypress", function(event) {
  if (event.key === "Enter") getWeather();
});

function showLoading(show) {
  document.getElementById("loading").style.display = show ? "block" : "none";
}

async function getWeather() {
  const city = document.getElementById("cityInput").value.trim();
  if (!city) return;

  showLoading(true);
  try {
    const currentWeather = await fetchCurrentWeather(city);
    const forecast = await fetchForecast(city);

    displayMainWeather(currentWeather);
    displayHourlyForecast(forecast);
    displayDailyForecast(forecast);
    loadWorldCities();
  } catch (error) {
    alert("❌ خطا: " + error.message);
  } finally {
    showLoading(false);
  }
}

async function fetchCurrentWeather(city) {
  const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=fa`;
  const response = await fetch(url);
  if (!response.ok) throw new Error("شهر پیدا نشد یا خطا در دریافت اطلاعات");
  return await response.json();
}

async function fetchForecast(city) {
  const url = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric&lang=fa`;
  const response = await fetch(url);
  if (!response.ok) throw new Error("خطا در دریافت پیش‌بینی");
  return await response.json();
}

function getIconUrl(iconCode, size = '2x') {
  return `https://openweathermap.org/img/wn/${iconCode}@${size}.png`;
}

function displayMainWeather(data) {
  const temp = Math.round(data.main.temp);
  const description = data.weather[0].description;
  const icon = data.weather[0].icon;
  const html = `
    <div class="weather-card">
      <h2>${data.name}, ${data.sys.country}</h2>
      <img class="weather-icon-main" src="${getIconUrl(icon)}" alt="${description}">
      <p>دما: ${temp}°C</p>
      <p>${description}</p>
      <p>رطوبت: ${data.main.humidity}% | فشار هوا: ${data.main.pressure} hPa</p>
      <p>باد: ${data.wind.speed} m/s | دید: ${data.visibility / 1000} km</p>
    </div>
  `;
  document.getElementById("mainWeather").innerHTML = html;
}

function displayHourlyForecast(data) {
  const list = data.list;
  const now = new Date();
  const currentHour = now.getHours();
  const currentMinute = now.getMinutes();

  // پیدا کردن نزدیک‌ترین زمان نیم‌ساعته آینده
  const baseMinutes = currentMinute < 30 ? 30 : 60;
  const baseTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), currentHour, baseMinutes);

  let html = '<div class="weather-card"><h3>🌡️ پیش‌بینی ساعتی (هر نیم‌ساعت)</h3><div style="display:flex; overflow-x:auto; gap:15px;">';
  let count = 0;

  for (let i = 0; i < list.length && count < 8; i++) {
    const item = list[i];
    const itemTime = new Date(item.dt * 1000);
    if (itemTime >= baseTime) {
      const hour = itemTime.getHours().toString().padStart(2, '0');
      const min = itemTime.getMinutes().toString().padStart(2, '0');
      html += `
        <div class="hourly-item">
          <strong>${hour}:${min}</strong>
          <img class="weather-icon-small" src="${getIconUrl(item.weather[0].icon, '2x')}" alt="">
          <div>${Math.round(item.main.temp)}°C</div>
          <div style="font-size:0.85rem;">${item.weather[0].description}</div>
        </div>
      `;
      count++;
    }
  }
  html += '</div></div>';
  document.getElementById("hourlyForecast").innerHTML = html;
}

function displayDailyForecast(data) {
  const dailyData = {};
  data.list.forEach(item => {
    const date = new Date(item.dt * 1000);
    const day = date.toDateString();
    if (!dailyData[day]) dailyData[day] = [];
    dailyData[day].push(item);
  });

  let html = '<div class="weather-card"><h3>📅 پیش‌بینی ۵ روز آینده</h3><div style="display:flex; flex-wrap:wrap; justify-content:center; gap:10px;">';
  Object.values(dailyData).slice(0, 5).forEach(dayList => {
    const temps = dayList.map(i => i.main.temp);
    const icons = dayList.map(i => i.weather[0].icon);
    const descriptions = dayList.map(i => i.weather[0].description);
    const humidity = dayList.map(i => i.main.humidity);
    const wind = dayList.map(i => i.wind.speed);

    const avg = arr => arr.reduce((a, b) => a + b) / arr.length;
    const icon = icons[Math.floor(icons.length / 2)];

    html += `
      <div class="daily-item">
        <h4>${new Date(dayList[0].dt * 1000).toLocaleDateString('fa-IR', { weekday: 'long' })}</h4>
        <img class="weather-icon-small" src="${getIconUrl(icon)}" alt="">
        <div>دما: ${Math.round(Math.min(...temps))}° / ${Math.round(Math.max(...temps))}°</div>
        <div>رطوبت: ${Math.round(avg(humidity))}% | باد: ${avg(wind).toFixed(1)} m/s</div>
        <div>${descriptions[0]}</div>
      </div>
    `;
  });
  html += '</div></div>';
  document.getElementById("dailyForecast").innerHTML = html;
}

async function loadWorldCities() {
  const cities = ["Tehran,IR", "London,GB", "Paris,FR", "New York,US", "Tokyo,JP", "Istanbul,TR", "Moscow,RU", "Dubai,AE"];
  let html = "";
  for (const city of cities) {
    try {
      const data = await fetchCurrentWeather(city);
      const icon = data.weather[0].icon;
      html += `
        <div class="city-card">
          <h4>${data.name}</h4>
          <img class="weather-icon-small" src="${getIconUrl(icon)}" alt="">
          <div>${Math.round(data.main.temp)}°C</div>
          <div style="font-size:0.9rem;">${data.weather[0].description}</div>
        </div>
      `;
    } catch {
      html += `<div class="city-card"><h4>${city}</h4><p>⛔ خطا</p></div>`;
    }
  }
  document.getElementById("worldCities").innerHTML = html;
}

window.addEventListener('load', () => {
  loadWorldCities();
});

  </script>
</body>
</html>
