
<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>weather_web</title>
<style>
:root {
  --primary-bg: #f5f7fa;
  --secondary-bg: #e4e7eb;
  --text-color: #1e293b;
  --accent-color: #3b82f6;
  --card-bg: rgba(255, 255, 255, 0.95);
  --gradient: linear-gradient(135deg, #f5f7fa 0%, #e4e7eb 100%);
  --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

/* ØªÙ…â€ŒÙ‡Ø§ÛŒ Ù¾ÙˆÛŒØ§ */
body.clear {
  --primary-bg: #fffbeb;
  --secondary-bg: #fef3c7;
  --text-color: #92400e;
  --accent-color: #f59e0b;
  --card-bg: rgba(255, 251, 235, 0.95);
  --gradient: linear-gradient(135deg, 

#fffbeb 0%, #fef3c7 100%);
}

body.clouds {
  --primary-bg: #f8fafc;
  --secondary-bg: #f1f5f9;
  --text-color: #334155;
  --accent-color: #64748b;
  --card-bg: rgba(248, 250, 252, 0.95);
  --gradient: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
}

body.rain {
  --primary-bg: #eff6ff;
  --secondary-bg: #dbeafe;
  --text-color: #1e40af;
  --accent-color: #3b82f6;
  --card-bg: rgba(239, 246, 255, 0.95);
  --gradient: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
}

body.thunderstorm {
  --primary-bg: #f5f3ff;
  --secondary-bg: #ede9fe;
  --text-color: #5b21b6;
  --accent-color: #7c3aed;
  --card-bg: rgba(245, 243, 255, 0.95);
  --gradient: linear-gradient(135deg, 

#f5f3ff 0%, #ede9fe 100%);
}

body.snow {
  --primary-bg: #f0fdf4;
  --secondary-bg: #dcfce7;
  --text-color: #166534;
  --accent-color: #22c55e;
  --card-bg: rgba(240, 253, 244, 0.95);
  --gradient: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
}

body.mist {
  --primary-bg: #f8fafc;
  --secondary-bg: #f1f5f9;
  --text-color: #64748b;
  --accent-color: #94a3b8;
  --card-bg: rgba(248, 250, 252, 0.95);
  --gradient: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
}

body.night {
  --primary-bg: #1e293b;
  --secondary-bg: #0f172a;
  --text-color: #e2e8f0;
  --accent-color: #818cf8;
  --card-bg: rgba(30, 41, 59, 0.95);
  --gradient: linear-gradient(135deg, 

#1e293b 0%, #0f172a 100%);
}

body {
  font-family: 'Vazirmatn', sans-serif;
  background: var(--gradient);
  min-height: 100vh;
  color: var(--text-color);
  margin: 0;
  padding: 0;
  transition: all 0.5s ease;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

.header {
  text-align: center;
  margin-bottom: 30px;
  padding: 20px 0;
}

.header h1 {
  color: var(--text-color);
  font-size: 2.2rem;
  margin-bottom: 10px;
  font-weight: 700;

}

.search-box {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
  margin: 30px auto;
  background: var(--card-bg);
  padding: 25px;
  border-radius: 16px;
  box-shadow: var(--box-shadow);
  max-width: 600px;
  backdrop-filter: blur(8px);
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.search-input-container {
  width: 100%;
  display: flex;
  gap: 10px;
}

input {
  flex: 1;
  padding: 14px 20px;
  font-size: 1rem;
  border-radius: 12px;
  border: 1px solid var(--secondary-bg);
  background: rgba(255, 255, 255, 0.9);

  transition: all 0.3s ease;
  font-family: 'Vazirmatn', sans-serif;
}

input:focus {
  outline: none;
  border-color: var(--accent-color);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
}

button {
  padding: 14px 28px;
  background: var(--accent-color);
  color: white;
  border: none;
  border-radius: 12px;
  font-weight: 600;
  cursor: pointer;
  box-shadow: var(--box-shadow);
  transition: all 0.3s ease;
  font-family: 'Vazirmatn', sans-serif;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

.weather-section {

  margin: 30px 0;
}

.section-title {
  color: var(--text-color);
  font-size: 1.4rem;
  margin-bottom: 20px;
  padding-right: 15px;
  font-weight: 600;
}

.weather-card {
  background: var(--card-bg);
  padding: 25px;
  border-radius: 16px;
  box-shadow: var(--box-shadow);
  margin-bottom: 25px;
  backdrop-filter: blur(8px);
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.current-weather {
  text-align: center;
}

.weather-icon {
  width: 100px;
  height: 100px;
  margin: 10px auto;
  filter: drop-shadow(0 0 8px rgba(0, 0, 0, 

0.1));
}

.forecast-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 15px;
  margin-top: 20px;
}

.forecast-item {
  background: rgba(255, 255, 255, 0.8);
  padding: 18px;
  border-radius: 12px;
  text-align: center;
  box-shadow: var(--box-shadow);
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.forecast-item:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

.weather-icon-small {
  width: 50px;
  height: 50px;

  margin: 8px auto;
  filter: drop-shadow(0 0 4px rgba(0, 0, 0, 0.1));
}

.city-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.city-card {
  background: var(--card-bg);
  padding: 20px;
  border-radius: 12px;
  text-align: center;
  box-shadow: var(--box-shadow);
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.city-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

.spinner {

  width: 50px;
  height: 50px;
  border: 5px solid rgba(59, 130, 246, 0.1);
  border-top: 5px solid var(--accent-color);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 20px auto;
}

#loading {
  display: none;
  text-align: center;
  color: var(--text-color);
  margin: 30px 0;
}

.error-message {
  color: #dc2626;
  text-align: center;
  margin: 20px 0;
  font-weight: 500;
}

/* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø®Ø§Øµ Ø¨Ø±Ø§ÛŒ ØªÙ… night */
body.night .weather-card,
body.night .city-card,
body.night .forecast-item {
  background: var(--card-bg);
  color: var(--text-color);
  border: 1px solid rgba(255, 255, 255, 0.1);

}

body.night input {
  background: rgba(30, 41, 59, 0.8);
  color: var(--text-color);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

body.night input:focus {
  box-shadow: 0 0 0 3px rgba(129, 140, 248, 0.2);
}

body.night .forecast-item {
  background: rgba(30, 41, 59, 0.8);
}

/* Ø¨Ù‡Ø¨ÙˆØ¯ Ú†ÛŒØ¯Ù…Ø§Ù† Ø¨Ø®Ø´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ¹Ù„ÛŒ */
.current-weather-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
  margin-top: 20px;
  text-align: right;
}

.current-weather-grid > div {
  padding: 10px;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.2);

  display: flex;
  flex-direction: column;
}

.current-weather-grid > div > div:first-child {
  font-weight: 600;
  margin-bottom: 5px;
  font-size: 0.95rem;
  color: var(--accent-color);
}

/* Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
@media (max-width: 768px) {
  .header h1 {
    font-size: 1.8rem;
  }
  .search-box {
    padding: 20px;
  }
  .forecast-container {
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 12px;
  }
  .city-grid {
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 15px;
  }

  .weather-icon {
    width: 80px;
    height: 80px;
  }
}

@media (max-width: 480px) {
  .search-input-container {
    flex-direction: column;
  }
  button {
    width: 100%;
  }
  .forecast-container {
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  }
  .city-grid {
    grid-template-columns: 1fr;
  }
  .header h1 {
    font-size: 1.6rem;
  }
  .current-weather-grid {
    grid-template-columns: 1fr;
  }
}

@keyframes spin {
  0% { transform: rotate(0deg); }

  100% { transform: rotate(360deg); }
}
</style>
<link href="https://v1.fontapi.ir/css/Vazirmatn" rel="stylesheet">
</head>

<body>
<div class="container">
  <div class="header">
    <h1>ğŸŒ¤ï¸ Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</h1>
  </div>
  <div class="search-box">
    <div class="search-input-container">
      <input type="text" id="cityInput" placeholder="Ù†Ø§Ù… Ø´Ù‡Ø± ÛŒØ§ Ú©Ø´ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯...">
      <button onclick="getWeather()">ğŸ” Ø¬Ø³ØªØ¬Ùˆ</button>
    </div>
  </div>
  <div id="loading">
    <div class="spinner"></div>
    <p>Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª...</p>
  </div>
  <div id="errorContainer" class="error-message"></div>
  <div id="currentWeather" class="weather-section" style="display: none;"></div>
  <div id="hourlySection" class="weather-section" style="display: none;">

    <h2 class="section-title">â±ï¸ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø³Ø§Ø¹ØªÛŒ</h2>
    <div id="hourlyForecast" class="weather-card"></div>
  </div>
  <div id="dailySection" class="weather-section" style="display: none;">
    <h2 class="section-title">ğŸ“… Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ûµ Ø±ÙˆØ² Ø¢ÛŒÙ†Ø¯Ù‡</h2>
    <div id="dailyForecast" class="weather-card"></div>
  </div>
  <div id="globalWeatherSection" class="weather-section">
    <h2 class="section-title">ğŸŒ Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§ÛŒ Ø´Ù‡Ø±Ù‡Ø§ÛŒ Ø¬Ù‡Ø§Ù†</h2>
    <div id="globalWeather" class="city-grid"></div>
  </div>
  <div class="weather-section">
    <h2 class="section-title">ğŸ™ï¸ Ø´Ù‡Ø±Ù‡Ø§ÛŒ Ù…Ù‡Ù… Ø§ÛŒØ±Ø§Ù†</h2>
    <div id="iranCities" class="city-grid"></div>
  </div>
</div>

<script>
const apiKey = "ee24450910228c08cc8613af1e387e85";


// ØªÙ†Ø¸ÛŒÙ… ØªÙ… Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§ Ùˆ Ø²Ù…Ø§Ù† Ø±ÙˆØ² Ø¯Ø± Ø´Ù‡Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø±
function setWeatherTheme(weatherData) {
  const body = document.body;
  body.className = '';
  
  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ù…Ø­Ù„ÛŒ Ø´Ù‡Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø±
  const now = new Date();
  const timezoneOffset = weatherData.timezone; // ØªÙØ§ÙˆØª Ø²Ù…Ø§Ù†ÛŒ Ø¨Ø± Ø­Ø³Ø¨ Ø«Ø§Ù†ÛŒÙ‡
  const localTime = new Date(now.getTime() + (timezoneOffset * 1000));
  const hours = localTime.getUTCHours();
  const isNight = hours < 6 || hours >= 18;
  
  const weatherMain = weatherData.weather[0].main.toLowerCase();
  
  // Ø§ÙˆÙ„ÙˆÛŒØª Ø¨Ø§ ÙˆØ¶Ø¹ÛŒØª Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§ Ø§Ø³Øª
  if (isNight) {
    body.classList.add('night');
  } else {
    switch(weatherMain) {
      case 'clear':
        body.classList.add('clear');
        break;
      case 'clouds':
        body.classList.add('clouds');

        break;
      case 'rain':
      case 'drizzle':
        body.classList.add('rain');
        break;
      case 'thunderstorm':
        body.classList.add('thunderstorm');
        break;
      case 'snow':
        body.classList.add('snow');
        break;
      case 'mist':
      case 'haze':
      case 'fog':
      case 'smoke':
        body.classList.add('mist');
        break;
      default:
        // ØªÙ… Ù¾ÛŒØ´â€ŒÙØ±Ø¶
    }
  }
}

// Ù†Ù…Ø§ÛŒØ´/Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ
function toggleSearchSections(show) {
  const sections = ['currentWeather', 'hourlySection', 'dailySection'];
  sections.forEach(section => {
    const el = document.getElementById(section);

    if (el) {
      el.style.display = show ? 'block' : 'none';
    }
  });
}

document.getElementById("cityInput").addEventListener("keypress", function(event) {
  if (event.key === "Enter") getWeather();
});

function showLoading(show) {
  document.getElementById("loading").style.display = show ? "block" : "none";
}

function showError(message) {
  const errorContainer = document.getElementById("errorContainer");
  errorContainer.textContent = message;
  errorContainer.style.display = message ? "block" : "none";
}

async function getWeather() {
  const city = document.getElementById("cityInput").value.trim();

  if (!city) {
    showError("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø´Ù‡Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");
    return;
  }

  showError("");
  showLoading(true);

  try {
    const currentWeather = await fetchCurrentWeather(city);
    const forecast = await fetchForecast(city);
    setWeatherTheme(currentWeather);
    displayCurrentWeather(currentWeather);
    displayHourlyForecast(forecast);
    displayDailyForecast(forecast);
    toggleSearchSections(true);
  } catch (error) {
    showError("âŒ Ø®Ø·Ø§: " + error.message);
    toggleSearchSections(false);
  } finally {
    showLoading(false);
  }
}

async function fetchCurrentWeather(city) {
  const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}

&units=metric&lang=fa`;
  const response = await fetch(url);
  if (!response.ok) {
    const errorData = await response.json();
    throw new Error(errorData.message || "Ø´Ù‡Ø± Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… ØµØ­ÛŒØ­ Ø´Ù‡Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");
  }
  return await response.json();
}

async function fetchForecast(city) {
  const url = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric&lang=fa`;
  const response = await fetch(url);
  if (!response.ok) {
    const errorData = await response.json();
    throw new Error(errorData.message || "Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§");
  }
  return await response.json();
}

function getWeatherIcon(weatherData) {
  const iconCode = weatherData.weather[0].icon;
  const isNight = iconCode.includes('n');

  // Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ Ø¨Ø±Ø§ÛŒ Ø´Ø±Ø§ÛŒØ· Ù…Ø®ØªÙ„Ù

  const customIcons = {
    '01d': 'â˜€ï¸', // Ø¢ÙØªØ§Ø¨ÛŒ Ø±ÙˆØ²
    '01n': 'ğŸŒ™', // Ø¢ÙØªØ§Ø¨ÛŒ Ø´Ø¨
    '02d': 'â›…', // Ú©Ù…ÛŒ Ø§Ø¨Ø±ÛŒ Ø±ÙˆØ²
    '02n': 'â›…', // Ú©Ù…ÛŒ Ø§Ø¨Ø±ÛŒ Ø´Ø¨
    '03d': 'â˜ï¸', // Ø§Ø¨Ø±ÛŒ
    '03n': 'â˜ï¸', // Ø§Ø¨Ø±ÛŒ
    '04d': 'â˜ï¸', // Ø§Ø¨Ø±Ù‡Ø§ÛŒ Ù¾Ø±Ø§Ú©Ù†Ø¯Ù‡
    '04n': 'â˜ï¸', // Ø§Ø¨Ø±Ù‡Ø§ÛŒ Ù¾Ø±Ø§Ú©Ù†Ø¯Ù‡
    '09d': 'ğŸŒ§ï¸', // Ø¨Ø§Ø±Ø§Ù†ÛŒ
    '09n': 'ğŸŒ§ï¸', // Ø¨Ø§Ø±Ø§Ù†ÛŒ
    '10d': 'ğŸŒ¦ï¸', // Ø¨Ø§Ø±Ø§Ù† Ùˆ Ø¢ÙØªØ§Ø¨
    '10n': 'ğŸŒ¦ï¸', // Ø¨Ø§Ø±Ø§Ù† Ùˆ Ø¢ÙØªØ§Ø¨
    '11d': 'â›ˆï¸', // Ø±Ø¹Ø¯ Ùˆ Ø¨Ø±Ù‚
    '11n': 'â›ˆï¸', // Ø±Ø¹Ø¯ Ùˆ Ø¨Ø±Ù‚
    '13d': 'â„ï¸', // Ø¨Ø±ÙÛŒ
    '13n': 'â„ï¸', // Ø¨Ø±ÙÛŒ
    '50d': 'ğŸŒ«ï¸', // Ù…Ù‡
    '50n': 'ğŸŒ«ï¸' // Ù…Ù‡
  };

  return customIcons[iconCode] || `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
}

function displayCurrentWeather(data) {
  const temp = Math.round(data.main.temp);
  const feelsLike = Math.round(data.main.feels_like);

  const description = data.weather[0].description;
  const icon = getWeatherIcon(data);
  const humidity = data.main.humidity;
  const pressure = data.main.pressure;
  const windSpeed = data.wind.speed;
  const windDeg = data.wind.deg;
  const visibility = data.visibility / 1000;
  
  // Ù†Ù…Ø§ÛŒØ´ Ø²Ù…Ø§Ù† Ø·Ù„ÙˆØ¹ Ùˆ ØºØ±ÙˆØ¨ Ø®ÙˆØ±Ø´ÛŒØ¯ Ø¨Ù‡ ÙˆÙ‚Øª Ù…Ø­Ù„ÛŒ
  const timezoneOffset = data.timezone * 1000; // Ø¨Ù‡ Ù…ÛŒÙ„ÛŒâ€ŒØ«Ø§Ù†ÛŒÙ‡
  const sunrise = new Date(data.sys.sunrise * 1000 + timezoneOffset).toLocaleTimeString('fa-IR');
  const sunset = new Date(data.sys.sunset * 1000 + timezoneOffset).toLocaleTimeString('fa-IR');
  
  const windDirection = getWindDirection(windDeg);

  const html = `
    <div class="weather-card current-weather">
      <h2>${data.name}, ${data.sys.country}</h2>
      <div style="font-size: 3rem; margin: 

10px 0;">${icon}</div>
      <div style="font-size: 2.5rem; font-weight: 700; margin: 10px 0;">${temp}Â°C</div>
      <div style="font-size: 1.1rem; margin-bottom: 15px; text-transform: capitalize;">${description}</div>
      <div class="current-weather-grid">
        <div>
          <div>Ø§Ø­Ø³Ø§Ø³ ÙˆØ§Ù‚Ø¹ÛŒ</div>
          <div>${feelsLike}Â°C</div>
        </div>
        <div>
          <div>Ø±Ø·ÙˆØ¨Øª</div>
          <div>${humidity}%</div>
        </div>
        <div>
          <div>Ø³Ø±Ø¹Øª Ø¨Ø§Ø¯</div>
          <div>${windSpeed} m/s (${windDirection})</div>
        </div>
        <div>
          <div>ÙØ´Ø§Ø± Ù‡ÙˆØ§</div>
          <div>${pressure} hPa</div>
        </div>
        <div>
          <div>Ø¯ÛŒØ¯</div>
          <div>${visibility} km</div>
        </div>
        <div>

          <div>Ø·Ù„ÙˆØ¹ Ø¢ÙØªØ§Ø¨</div>
          <div>${sunrise}</div>
        </div>
        <div>
          <div>ØºØ±ÙˆØ¨ Ø¢ÙØªØ§Ø¨</div>
          <div>${sunset}</div>
        </div>
        <div>
          <div>Ù…Ø®ØªØµØ§Øª</div>
          <div>${data.coord.lat.toFixed(2)}, ${data.coord.lon.toFixed(2)}</div>
        </div>
      </div>
    </div>
  `;

  document.getElementById("currentWeather").innerHTML = html;
}

function getWindDirection(degrees) {
  const directions = ['Ø´Ù…Ø§Ù„ÛŒ', 'Ø´Ù…Ø§Ù„ Ø´Ø±Ù‚ÛŒ', 'Ø´Ø±Ù‚ÛŒ', 'Ø¬Ù†ÙˆØ¨ Ø´Ø±Ù‚ÛŒ', 'Ø¬Ù†ÙˆØ¨ÛŒ', 'Ø¬Ù†ÙˆØ¨ ØºØ±Ø¨ÛŒ', 'ØºØ±Ø¨ÛŒ', 'Ø´Ù…Ø§Ù„ ØºØ±Ø¨ÛŒ'];
  const index = Math.round((degrees % 360) / 45) % 8;
  return directions[index];
}

function displayHourlyForecast(data) {
  const now = new Date();
  const hourlyItems = [];
  let startIndex = -1;

  for (let i = 0; i < data.list.length; i++) {
    const itemTime = new Date(data.list[i].dt * 1000);
    if (itemTime > now) {
      startIndex = i;
      break;
    }
  }

  if (startIndex === -1) {
    document.getElementById("hourlyForecast").innerHTML = '<p>Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø³Ø§Ø¹ØªÛŒ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª</p>';
    return;
  }

  const forecastItems = [];
  for (let i = startIndex; i < data.list.length && forecastItems.length < 12; i++) {
    const item = data.list[i];
    const itemTime = new Date(item.dt * 1000);
    if (forecastItems.length === 0 || 
        (itemTime - new 

Date(forecastItems[forecastItems.length-1].dt * 1000)) >= 30 * 60 * 1000) {
      forecastItems.push(item);
    }
  }

  let html = '<div class="forecast-container">';
  forecastItems.forEach(item => {
    const itemTime = new Date(item.dt * 1000);
    const hours = itemTime.getHours().toString().padStart(2, '0');
    const minutes = itemTime.getMinutes().toString().padStart(2, '0');
    const temp = Math.round(item.main.temp);
    const feelsLike = Math.round(item.main.feels_like);
    const humidity = item.main.humidity;
    const pop = Math.round(item.pop * 100);
    const icon = getWeatherIcon(item);

    html += `
      <div class="forecast-item">
        <div style="font-weight: 600;">${hours}:${minutes}</div>
        <div style="font-size: 1.8rem; margin: 5px 0;">${icon}</div>

        <div style="font-size: 1.2rem; font-weight: 600; margin: 5px 0;">${temp}Â°C</div>
        <div style="font-size: 0.85rem; color: var(--text-color);">Ø§Ø­Ø³Ø§Ø³: ${feelsLike}Â°C</div>
        <div style="font-size: 0.85rem;">Ø±Ø·ÙˆØ¨Øª: ${humidity}%</div>
        <div style="font-size: 0.85rem;">Ø¨Ø§Ø±Ø´: ${pop}%</div>
      </div>
    `;
  });
  html += '</div>';
  document.getElementById("hourlyForecast").innerHTML = html;
}

function displayDailyForecast(data) {
  const now = new Date();
  now.setHours(0, 0, 0, 0);
  const dailyData = {};

  data.list.forEach(item => {
    const itemDate = new Date(item.dt * 1000);
    itemDate.setHours(0, 0, 0, 0);
    if (itemDate > now) {
      const dateKey = 

itemDate.toDateString();
      if (!dailyData[dateKey]) {
        dailyData[dateKey] = [];
      }
      dailyData[dateKey].push(item);
    }
  });

  const sortedDays = Object.entries(dailyData)
    .sort((a, b) => new Date(a[0]) - new Date(b[0]))
    .slice(0, 5);

  let html = '<div class="forecast-container">';
  sortedDays.forEach(([date, dayItems]) => {
    const dayDate = new Date(date);
    const temps = dayItems.map(item => item.main.temp);
    const feelsLike = dayItems.map(item => item.main.feels_like);
    const icons = dayItems.map(item => item.weather[0].icon);
    const descriptions = dayItems.map(item => item.weather[0].description);
    const humidity = dayItems.map(item => item.main.humidity);
    const wind = dayItems.map(item => item.wind.speed);

    const pop = dayItems.map(item => item.pop);

    const maxTemp = Math.max(...temps);
    const minTemp = Math.min(...temps);
    const avgFeelsLike = feelsLike.reduce((sum, temp) => sum + temp, 0) / feelsLike.length;
    const avgHumidity = humidity.reduce((sum, h) => sum + h, 0) / humidity.length;
    const avgWind = wind.reduce((sum, w) => sum + w, 0) / wind.length;
    const maxPop = Math.max(...pop) * 100;

    const icon = getWeatherIcon(dayItems[Math.floor(dayItems.length / 2)]);
    const description = descriptions[0];

    html += `
      <div class="forecast-item">
        <div style="font-weight: 600;">${dayDate.toLocaleDateString('fa-IR', { weekday: 'long' })}</div>
        <div style="font-size: 1.8rem; margin: 8px 0;">${icon}</div>
        <div style="margin: 8px 0;">
          <span style="font-weight: 600;">${Math.round(maxTemp)}Â°</span> /

          <span>${Math.round(minTemp)}Â°</span>
        </div>
        <div style="font-size: 0.85rem; text-transform: capitalize;">${description}</div>
        <div style="font-size: 0.75rem; margin-top: 8px;">
          <div>Ø§Ø­Ø³Ø§Ø³: ${Math.round(avgFeelsLike)}Â°C</div>
          <div>Ø±Ø·ÙˆØ¨Øª: ${Math.round(avgHumidity)}%</div>
          <div>Ø¨Ø§Ø¯: ${avgWind.toFixed(1)} m/s</div>
          <div>Ø¨Ø§Ø±Ø´: ${Math.round(maxPop)}%</div>
        </div>
      </div>
    `;
  });
  html += '</div>';
  document.getElementById("dailyForecast").innerHTML = html;
}

async function loadGlobalWeather() {
  const globalCities = [
    {name: "Ù†ÛŒÙˆÛŒÙˆØ±Ú©", country: "US"},
    {name: "Ù„Ù†Ø¯Ù†", country: "GB"},
    {name: "Ù¾Ø§Ø±ÛŒØ³", country: "FR"},

    {name: "ØªÙˆÚ©ÛŒÙˆ", country: "JP"},
    {name: "Ù¾Ú©Ù†", country: "CN"},
    {name: "Ø¯Ø¨ÛŒ", country: "AE"},
    {name: "Ø³ÛŒØ¯Ù†ÛŒ", country: "AU"},
    {name: "Ù…ÙˆØ³Ú©Ùˆ", country: "RU"}
  ];

  let html = "";
  for (const city of globalCities) {
    try {
      const data = await fetchCurrentWeather(`${city.name},${city.country}`);
      const icon = getWeatherIcon(data);
      const temp = Math.round(data.main.temp);
      const description = data.weather[0].description;

      html += `
        <div class="city-card">
          <h3 style="margin: 0 0 10px 0;">${data.name}</h3>
          <div style="font-size: 1.8rem; margin: 5px 0;">${icon}</div>
          <div style="font-size: 1.2rem; font-weight: 600; margin: 5px 0;">${temp}Â°C</div>
          <div style="font-size: 0.85rem; text-transform: capitalize;">${description}</div>

        </div>
      `;
    } catch (error) {
      console.error(`Error loading data for ${city.name}:`, error);
      html += `
        <div class="city-card">
          <h3 style="margin: 0 0 10px 0;">${city.name}</h3>
          <div style="color: #dc2626; font-size: 0.85rem;">Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡</div>
        </div>
      `;
    }
  }
  document.getElementById("globalWeather").innerHTML = html;
}

async function loadIranCities() {
  const iranCities = [
    "ØªÙ‡Ø±Ø§Ù†", "Ù…Ø´Ù‡Ø¯", "Ø§ØµÙÙ‡Ø§Ù†", "ØªØ¨Ø±ÛŒØ²", "Ø´ÛŒØ±Ø§Ø²",
    "Ø§Ù‡ÙˆØ§Ø²", "Ú©Ø±Ø¬", "Ù‚Ù…", "Ú©Ø±Ù…Ø§Ù†Ø´Ø§Ù‡", "Ø±Ø´Øª"
  ];

  let html = "";
  for (const city of iranCities) {
    try {
      const data = await 

fetchCurrentWeather(`${city},IR`);
      const icon = getWeatherIcon(data);
      const temp = Math.round(data.main.temp);
      const description = data.weather[0].description;

      html += `
        <div class="city-card">
          <h3 style="margin: 0 0 10px 0;">${data.name}</h3>
          <div style="font-size: 1.8rem; margin: 5px 0;">${icon}</div>
          <div style="font-size: 1.2rem; font-weight: 600; margin: 5px 0;">${temp}Â°C</div>
          <div style="font-size: 0.85rem; text-transform: capitalize;">${description}</div>
        </div>
      `;
    } catch (error) {
      console.error(`Error loading data for ${city}:`, error);
      html += `
        <div class="city-card">
          <h3 style="margin: 0 0 10px 0;">${city}</h3>
          <div style="color: #dc2626; font-size: 0.85rem;">Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡</div>
        </div>

      `;
    }
  }
  document.getElementById("iranCities").innerHTML = html;
}

// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
window.addEventListener('load', () => {
  loadGlobalWeather();
  loadIranCities();
  toggleSearchSections(false);
});
</script>
</body>
</html>